var JuSy={};JuSy.DEBUG=true;JuSy.run=function(){var d=(new JuSy.LocalDb.Factory).getLocalDb();if(d==null)throw new Error("Didn't find any available datasource");else JuSy.log(d.name);migrations={"1":"CREATE TABLE Status (Id INTEGER PRIMARY KEY AUTOINCREMENT, Key TEXT NOT NULL)","2":"ALTER TABLE Status ADD COLUMN Value TEXT","3":'INSERT INTO Status (Key, Value) VALUES ("testkey", "testval")'};d.open({name:"JuSy",description:"JuSy status database",size:1048576,version:"3",migrations:migrations})};JuSy.LocalDb=JuSy.LocalDb||{};JuSy.LocalDb.API=JuSy.LocalDb.API||{};JuSy.LocalDb.API.Gears=function(){this.name="Google Gears Database";this.priority=10;this.isAvailable=function(){if(window.google&&window.google.gears)return true;return false};this.open=function(){}};JuSy.LocalDb=JuSy.LocalDb||{};JuSy.LocalDb.API=JuSy.LocalDb.API||{};
JuSy.LocalDb.API.Html5=function(){function d(a,e){var g=b.version===""?0:b.version;g===0&&JuSy.log("[Html5Db] Created new database");if(g<e){e=[];for(var f in a)parseInt(f)>g&&e.push(parseInt(f));e.sort(function(h,i){return i-h});c(e,a)}}function c(a,e){if(a.length>0){var g=String(a.pop());b.changeVersion(b.version,g,function(f){f.executeSql(e[g])},function(f){JuSy.log(f)},function(){JuSy.log("[Html5Db] Database migrated to version : "+g);c(a,e)})}}this.name="HTML 5 Web SQL Database";this._priority=
1;var b;this.isAvailable=function(){if(window.openDatabase)return true;return false};this.open=function(a){if(typeof a.name==="undefined")throw new Error("[Html5Db] Tried to open database without supplying a unique name");if(typeof a.migrations==="undefined")throw new Error("[Html5Db] Tried to open database without at least one migration");a.size=!("size"in a)||isNaN(a.size)?5242880:a.size;a.description="description"in a?a.description:a.name;b=openDatabase(a.name,"",a.description,a.size);d(a.migrations,
a.version)}};JuSy.LocalDb=JuSy.LocalDb||{};JuSy.LocalDb.API=JuSy.LocalDb.API||{};JuSy.LocalDb.API.IndexedDb=function(){this.name="Indexed Database";this.priority=5;this.isAvailable=function(){if(window.indexedDB)return true;return false};this.open=function(){}};JuSy.LocalDb=JuSy.LocalDb||{};JuSy.LocalDb.InterfaceAPI=new Interface("InterfaceAPI",["isAvailable","open"]);
JuSy.LocalDb.Factory=function(){function d(){for(var b in JuSy.LocalDb.API)if(typeof JuSy.LocalDb.API[b]=="function"){var a=new JuSy.LocalDb.API[b];Interface.ensureImplements(a,JuSy.LocalDb.InterfaceAPI);if(a.isAvailable()){c.push(a);JuSy.log("[Factory] Found available API : "+a.name)}}}var c=[];this.getLocalDb=function(){d();if(c.length>0){c.sort(function(b,a){return b._priority-a._prority});return c[0]}JuSy.log("[Factory] No available local db found");return null}};var Interface=function(d,c){if(arguments.length!=2)throw new Error("Interface constructor called with "+arguments.length+"arguments, but expected exactly 2.");this.name=d;this.methods=[];for(var b=0,a=c.length;b<a;b++){if(typeof c[b]!=="string")throw new Error("Interface constructor expects method names to be passed in as a string.");this.methods.push(c[b])}};
Interface.ensureImplements=function(d){if(arguments.length<2)throw new Error("Function Interface.ensureImplements called with "+arguments.length+"arguments, but expected at least 2.");for(var c=1,b=arguments.length;c<b;c++){var a=arguments[c];if(a.constructor!==Interface)throw new Error("Function Interface.ensureImplements expects arguments two and above to be instances of Interface.");for(var e=0,g=a.methods.length;e<g;e++){var f=a.methods[e];if(!d[f]||typeof d[f]!=="function")throw new Error("Interface.ensureImplements: object does not implement the '"+
a.name+"' interface. Method '"+f+"()' was not found.");}}};JuSy.log=function(d){JuSy.DEBUG&&window.console.info(d)};
